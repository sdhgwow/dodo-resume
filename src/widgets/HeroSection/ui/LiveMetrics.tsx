import { motion } from "framer-motion";
import { useEffect, useState, type JSX } from "react";
import { METRICS } from "@/shared/config/constants";
import styles from "./LiveMetrics.module.css";

interface Metric {
  label: string;
  value: string | number;
  icon: string | JSX.Element;
  color: string;
  animated?: boolean;
}

const Icons = {
  calendar: (color: string) => (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlnsXlink="http://www.w3.org/1999/xlink"
      width="50"
      height="50"
      viewBox="-1 0 32 32"
      version="1.1"
    >
      <defs></defs>
      <g
        id="Page-1"
        stroke="none"
        strokeWidth="1"
        fill="none"
        fillRule="evenodd"
      >
        <g
          id="Icon-Set"
          transform="translate(-309.000000, -359.000000)"
          fill={color}
        >
          <path
            d="M323,383 L325,383 L325,385 L323,385 L323,383 Z M323,387 L325,387 C326.104,387 327,386.104 327,385 L327,383 C327,381.896 326.104,381 325,381 L323,381 C321.896,381 321,381.896 321,383 L321,385 C321,386.104 321.896,387 323,387 L323,387 Z M315,383 L317,383 L317,385 L315,385 L315,383 Z M315,387 L317,387 C318.104,387 319,386.104 319,385 L319,383 C319,381.896 318.104,381 317,381 L315,381 C313.896,381 313,381.896 313,383 L313,385 C313,386.104 313.896,387 315,387 L315,387 Z M323,375 L325,375 L325,377 L323,377 L323,375 Z M323,379 L325,379 C326.104,379 327,378.104 327,377 L327,375 C327,373.896 326.104,373 325,373 L323,373 C321.896,373 321,373.896 321,375 L321,377 C321,378.104 321.896,379 323,379 L323,379 Z M315,375 L317,375 L317,377 L315,377 L315,375 Z M315,379 L317,379 C318.104,379 319,378.104 319,377 L319,375 C319,373.896 318.104,373 317,373 L315,373 C313.896,373 313,373.896 313,375 L313,377 C313,378.104 313.896,379 315,379 L315,379 Z M337,367 L311,367 L311,365 C311,363.896 311.896,363 313,363 L317,363 L317,364 C317,364.553 317.447,365 318,365 C318.553,365 319,364.553 319,364 L319,363 L329,363 L329,364 C329,364.553 329.447,365 330,365 C330.553,365 331,364.553 331,364 L331,363 L335,363 C336.104,363 337,363.896 337,365 L337,367 L337,367 Z M337,387 C337,388.104 336.104,389 335,389 L313,389 C311.896,389 311,388.104 311,387 L311,369 L337,369 L337,387 L337,387 Z M335,361 L331,361 L331,360 C331,359.448 330.553,359 330,359 C329.447,359 329,359.448 329,360 L329,361 L319,361 L319,360 C319,359.448 318.553,359 318,359 C317.447,359 317,359.448 317,360 L317,361 L313,361 C310.791,361 309,362.791 309,365 L309,387 C309,389.209 310.791,391 313,391 L335,391 C337.209,391 339,389.209 339,387 L339,365 C339,362.791 337.209,361 335,361 L335,361 Z M331,375 L333,375 L333,377 L331,377 L331,375 Z M331,379 L333,379 C334.104,379 335,378.104 335,377 L335,375 C335,373.896 334.104,373 333,373 L331,373 C329.896,373 329,373.896 329,375 L329,377 C329,378.104 329.896,379 331,379 L331,379 Z M331,383 L333,383 L333,385 L331,385 L331,383 Z M331,387 L333,387 C334.104,387 335,386.104 335,385 L335,383 C335,381.896 334.104,381 333,381 L331,381 C329.896,381 329,381.896 329,383 L329,385 C329,386.104 329.896,387 331,387 L331,387 Z"
            id="calendar"
          ></path>
        </g>
      </g>
    </svg>
  ),
  rocket: (color: string) => (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlnsXlink="http://www.w3.org/1999/xlink"
      version="1.1"
      id="_x32_"
      width="50"
      height="50"
      viewBox="0 0 512 512"
      xmlSpace="preserve"
    >
      <g>
        <path
          d="M127.083,247.824l50.031-76.906c0,0-74.734-29.688-109.547-3.078C32.755,194.465,0.005,268.184,0.005,268.184   l37.109,21.516C37.114,289.699,84.083,198.684,127.083,247.824z"
          fill={color}
        />
        <path
          d="M264.177,384.918l76.906-50.031c0,0,29.688,74.734,3.078,109.547   c-26.625,34.797-100.344,67.563-100.344,67.563l-21.5-37.109C222.317,474.887,313.333,427.918,264.177,384.918z"
          fill={color}
        />
        <path
          d="M206.692,362.887l-13.203-13.188c-24,62.375-80.375,49.188-80.375,49.188s-13.188-56.375,49.188-80.375   l-13.188-13.188c-34.797-6-79.188,35.984-86.391,76.766c-7.188,40.781-8.391,75.563-8.391,75.563s34.781-1.188,75.578-8.391   S212.692,397.684,206.692,362.887z"
          fill={color}
        />
        <path
          d="M505.224,6.777C450.786-18.738,312.927,28.98,236.255,130.668c-58.422,77.453-89.688,129.641-89.688,129.641   l46.406,46.406l12.313,12.313l46.391,46.391c0,0,52.219-31.25,129.672-89.656C483.005,199.074,530.739,61.215,505.224,6.777z    M274.63,237.371c-12.813-12.813-12.813-33.594,0-46.406s33.578-12.813,46.406,0.016c12.813,12.813,12.813,33.578,0,46.391   C308.208,250.184,287.442,250.184,274.63,237.371z M351.552,160.465c-16.563-16.578-16.563-43.422,0-59.984   c16.547-16.563,43.406-16.563,59.969,0s16.563,43.406,0,59.984C394.958,177.012,368.099,177.012,351.552,160.465z"
          fill={color}
        />
      </g>
    </svg>
  ),
  trophy: (color: string) => (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill={color}
      width="50"
      height="50"
      viewBox="0 0 24 24"
    >
      <path d="M22,3H19V2a1,1,0,0,0-1-1H6A1,1,0,0,0,5,2V3H2A1,1,0,0,0,1,4V6a4.994,4.994,0,0,0,4.276,4.927A7.009,7.009,0,0,0,11,15.92V18H7a1,1,0,0,0-.949.684l-1,3A1,1,0,0,0,6,23H18a1,1,0,0,0,.948-1.316l-1-3A1,1,0,0,0,17,18H13V15.92a7.009,7.009,0,0,0,5.724-4.993A4.994,4.994,0,0,0,23,6V4A1,1,0,0,0,22,3ZM5,8.829A3.006,3.006,0,0,1,3,6V5H5ZM16.279,20l.333,1H7.387l.334-1ZM17,9A5,5,0,0,1,7,9V3H17Zm4-3a3.006,3.006,0,0,1-2,2.829V5h2ZM10.667,8.667,9,7.292,11,7l1-2,1,2,2,.292L13.333,8.667,13.854,11,12,9.667,10.146,11Z" />
    </svg>
  ),
  coffee: (color: string) => (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlnsXlink="http://www.w3.org/1999/xlink"
      fill={color}
      height="50"
      width="50"
      version="1.1"
      id="Layer_1"
      viewBox="0 0 491.52 491.52"
      xmlSpace="preserve"
    >
      <g>
        <g>
          <path d="M261.357,228.048c-16.024,0-34.004,7.592-48.388,21.976c-21.425,21.427-27.768,51.732-15.818,70.678    c1.637-1.081,3.802-2.85,6.591-5.815c9.063-9.639,16.819-20.44,23.048-32.12c1.112-2.087,2.187-4.223,3.264-6.344    c3.236-6.417,6.572-13.031,11.22-19.408c8.665-11.889,21.175-21.064,35.197-26.386    C271.78,228.922,266.684,228.048,261.357,228.048z" />
        </g>
      </g>
      <g>
        <g>
          <path d="M366.725,0H124.801c-8,0-14.664,5.831-15.952,13.472h273.828C381.389,5.831,374.725,0,366.725,0z" />
        </g>
      </g>
      <g>
        <g>
          <path d="M131.585,382.68l12.44,94.608l-0.004-0.008c1.068,8.12,8.048,14.24,16.232,14.24h171.021    c8.184,0,15.164-6.12,16.228-14.24l12.44-94.6H131.585z" />
        </g>
      </g>
      <g>
        <g>
          <path d="M107.477,199.344l21.953,166.952h232.668l21.953-166.952H107.477z M290.145,327.2    c-17.272,17.272-39.511,26.705-60.108,26.705c-9.26,0-18.184-1.905-26.176-5.865c-5.084-2.528-9.652-5.799-13.584-9.734    c-0.604-0.601-1.196-1.249-1.788-1.905c-22.632-25.071-16.964-68.095,12.895-97.959c30.589-30.593,75.388-35.576,99.865-11.104    c0.096,0.095,0.656,0.688,0.748,0.791c4.6,4.856,8.076,10.257,10.54,16.264C323.045,270.024,314.049,303.304,290.145,327.2z" />
        </g>
      </g>
      <g>
        <g>
          <path d="M297.377,250.599c-1.144-2.783-2.71-5.291-4.463-7.659c-15.311,2.829-29.464,11.462-38.401,23.724    c-3.86,5.295-6.892,11.312-9.828,17.129c-1.137,2.247-2.264,4.479-3.436,6.679c-6.916,12.96-15.521,24.952-25.572,35.64    c-2.24,2.385-4.395,4.388-6.496,6.073c0.66,0.382,1.269,0.833,1.96,1.176c19.54,9.671,47.276,2.384,67.42-17.745    C297.549,296.632,305.285,269.896,297.377,250.599z" />
        </g>
      </g>
      <g>
        <g>
          <path d="M413.173,29.432l-20.101,0.026c-0.649,0.165-1.274,0.398-1.975,0.398H100.43c-0.051,0-0.092-0.028-0.141-0.028    l-22.483,0.028l-7.228,27.88h11.097h328.179h11.088L413.173,29.432z" />
        </g>
      </g>
      <g>
        <g>
          <polygon points="91.013,74.12 105.321,182.96 386.205,182.96 400.513,74.12   " />
        </g>
      </g>
    </svg>
  ),
};

export const LiveMetrics = () => {
  const [coffeeCount, setCoffeeCount] = useState(0);

  // анимация счетчика чашек кофе
  useEffect(() => {
    const targetValue = 2847;
    const increment = 47;
    const interval = 30;
    
    const coffeeInterval = setInterval(() => {
      setCoffeeCount((prev) => {
        if (prev >= targetValue) {
          clearInterval(coffeeInterval);
          return targetValue;
        }
        return prev + increment;
      });
    }, interval);

    return () => {
      clearInterval(coffeeInterval);
    };
  }, []);

  const metrics: Metric[] = [
    {
      label: "года в разработке",
      value: METRICS.yearsOfCoding,
      icon: "calendar",
      color: "var(--color-accent)",
    },
    {
      label: "проектов запущено",
      value: METRICS.projectsShipped,
      icon: "rocket",
      color: "var(--color-purple)",
    },
    {
      label: "лучший сотрудник месяца",
      value: `${METRICS.employeeOfMonth}x`,
      icon: "trophy",
      color: "var(--color-red)",
    },
    {
      label: "чашек кофе выпито",
      value: coffeeCount,
      icon: "coffee",
      color: "var(--color-yellow)",
    },
  ];

  return (
    <div className={styles.dashboard}>
      <div className={styles.header}>
        <div className={styles.title}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            viewBox="0 0 800 800"
            fill="none"
          >
            <path
              className={styles.titleIcoWH}
              d="M550 425H450C436.193 425 425 436.193 425 450V650C425 663.807 436.193 675 450 675H550C563.807 675 575 663.807 575 650V450C575 436.193 563.807 425 550 425Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M750 275H650C636.193 275 625 286.193 625 300V650C625 663.807 636.193 675 650 675H750C763.807 675 775 663.807 775 650V300C775 286.193 763.807 275 750 275Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M350 375H250C236.193 375 225 386.193 225 400V650C225 663.807 236.193 675 250 675H350C363.807 675 375 663.807 375 650V400C375 386.193 363.807 375 350 375Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M150 500H50C36.1929 500 25 511.193 25 525V650C25 663.807 36.1929 675 50 675H150C163.807 675 175 663.807 175 650V525C175 511.193 163.807 500 150 500Z"
            />
            <path
              className={styles.titleIcoSV}
              d="M775 625H25V700C25 719.891 32.9018 738.968 46.967 753.033C61.0322 767.098 80.1088 775 100 775H700C719.891 775 738.968 767.098 753.033 753.033C767.098 738.968 775 719.891 775 700V625Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M100 425H50C43.3696 425 37.0107 422.366 32.3223 417.678C27.6339 412.989 25 406.63 25 400C25 393.37 27.6339 387.011 32.3223 382.322C37.0107 377.634 43.3696 375 50 375H88L250 173.5C251.916 170.617 254.411 168.163 257.325 166.295C260.239 164.426 263.509 163.183 266.929 162.644C270.349 162.105 273.843 162.283 277.191 163.165C280.538 164.047 283.666 165.615 286.376 167.769C289.086 169.923 291.319 172.616 292.934 175.679C294.549 178.741 295.51 182.105 295.756 185.558C296.003 189.011 295.53 192.478 294.367 195.738C293.204 198.999 291.376 201.983 289 204.5L119.5 415.5C117.172 418.446 114.21 420.83 110.834 422.475C107.458 424.12 103.755 424.983 100 425Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M531.25 286C525.611 285.967 520.148 284.029 515.75 280.5C510.599 276.375 507.287 270.381 506.538 263.824C505.789 257.268 507.662 250.681 511.75 245.5L680.5 34.5C682.828 31.5537 685.79 29.1696 689.166 27.525C692.542 25.8803 696.245 25.0173 700 25H750C756.63 25 762.989 27.6339 767.678 32.3223C772.366 37.0107 775 43.3696 775 50C775 56.6304 772.366 62.9893 767.678 67.6777C762.989 72.3661 756.63 75 750 75H712L550 276.5C547.752 279.35 544.91 281.676 541.672 283.316C538.434 284.957 534.878 285.873 531.25 286Z"
            />
            <path
              className={styles.titleIcoWH}
              d="M354.957 159.935L324.964 199.94L444.979 289.92L474.972 249.915L354.957 159.935Z"
            />
            <path
              className={styles.titleIcoSV}
              d="M300 225C341.421 225 375 191.421 375 150C375 108.579 341.421 75 300 75C258.579 75 225 108.579 225 150C225 191.421 258.579 225 300 225Z"
            />
            <path
              className={styles.titleIcoSV}
              d="M500 374.75C541.421 374.75 575 341.171 575 299.75C575 258.329 541.421 224.75 500 224.75C458.579 224.75 425 258.329 425 299.75C425 341.171 458.579 374.75 500 374.75Z"
            />
          </svg>
          <h3>Кратко обо мне</h3>
        </div>
        <div className={styles.liveIndicator}>
          <span className={styles.liveDot} />
          <span>LIVE</span>
        </div>
      </div>

      <div className={styles.metricsGrid}>
        {metrics.map((metric) => (
          <motion.div
            key={metric.label}
            className={styles.metricCard}
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
          >
            <div className={styles.metricIcon}>
              {typeof metric.icon === "string" &&
              (Icons as Record<string, (color: string) => JSX.Element>)[
                metric.icon
              ]
                ? (Icons as Record<string, (color: string) => JSX.Element>)[
                    metric.icon
                  ](metric.color)
                : metric.icon}
            </div>
            <div className={styles.metricContent}>
              <div
                className={styles.metricValue}
                style={{ color: metric.color }}
              >
                {metric.value}
              </div>
              <div className={styles.metricLabel}>{metric.label}</div>
            </div>
            {metric.animated && (
              <div
                className={styles.pulse}
                style={{ backgroundColor: metric.color }}
              />
            )}
          </motion.div>
        ))}
      </div>

      <div className={styles.footer}>
        <div className={styles.timestamp}>
        <svg className={styles.clockIcon} xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M12 7V12L14.5 10.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
          Обновлено только что
        </div>
      </div>
    </div>
  );
};
